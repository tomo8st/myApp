<div class="login_header">    
    <mat-toolbar color="primary">
        <button mat-icon-button class="example-icon" 
          aria-label="Example icon-button with menu icon"
          routerLink="/login">
          <mat-icon>menu</mat-icon>
        </button>
        <span class="example-spacer"></span>
        <span>ToDo管理ツール</span>        
        <span class="example-spacer"></span>
        <span class="user-name">{{username}}</span>
    </mat-toolbar>
</div>

<div class="space_row"></div>

<mat-form-field class="input-field factory-input">
    <mat-label>日付</mat-label>
    <input matInput [matDatepicker]="picker" placeholder="日付" 
        autofocus #input1 class="ime-off" name="factory_input" 
        (dateChange)="onDateChange($event)"
        [(ngModel)]="targetDate">
    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
    <mat-datepicker #picker></mat-datepicker>
</mat-form-field>

<button type="button" name="button" (click)="onClickIpcTestBtn()">
    IPC呼び出し
</button>

<button type="button" name="button" (click)="onClickPlusButton()">
  +
</button>

<button type="button" name="button" (click)="onClickClearButton()">
  クリア
</button>

<button type="button" name="button" (click)="onClickSaveButton()">
  保存
</button>

<button type="button" name="button" (click)="onClickArrayDisplayButton()">
  配列表示
</button>

<div class="table-area">
    <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" >
      <ng-container matColumnDef="edit">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let element; let i = index">
          <button mat-icon-button (click)="toggleEdit(i)">
            <mat-icon>{{editableIndex === i ? 'done' : 'edit'}}</mat-icon>
          </button>
        </td>
      </ng-container>

      <ng-container matColumnDef="moveRow">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let element; let i = index">
          <button mat-icon-button (click)="moveRowUp(i)" [disabled]="i === 0">
            <mat-icon>arrow_upward</mat-icon>
          </button>
          <button mat-icon-button (click)="moveRowDown(i)" [disabled]="i === dataSource.length - 1">
            <mat-icon>arrow_downward</mat-icon>
          </button>
        </td>
      </ng-container>

      <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef
              class="table-header" 
              [style.font-size]="tblFontsize"> 
              日付
          </th>
          <td mat-cell *matCellDef="let element; let i = index"
              class="table-cell" 
              [style.font-size]="tblFontsize">
              <ng-container *ngIf="editableIndex === i; else readOnly">
                <input matInput [(ngModel)]="element.date" class="input-cell" />                
              </ng-container>
              <ng-template #readOnly>
                <div class="cell-content">{{element.date}}</div>
              </ng-template>              
          </td>
      </ng-container>
  
      <ng-container matColumnDef="category">
        <th mat-header-cell *matHeaderCellDef
            class="table-header"
            [style.font-size]="tblFontsize"> 
            カテゴリ
        </th>
        <td mat-cell *matCellDef="let element; let i = index"
            class="table-cell"
            [style.font-size]="tblFontsize">
              <ng-container *ngIf="editableIndex === i; else readOnly">
                <input matInput [(ngModel)]="element.category" class="input-cell" />                
              </ng-container>
              <ng-template #readOnly>
                <div class="cell-content">{{element.category}}</div>
              </ng-template>
        </td>
      </ng-container>
  
      <ng-container matColumnDef="meeting">
        <th mat-header-cell *matHeaderCellDef
            class="table-header"
            [style.font-size]="tblFontsize"> 
            MTG
        </th>
        <td mat-cell *matCellDef="let element; let i = index"
            class="table-cell"
            [style.font-size]="tblFontsize">
              <ng-container *ngIf="editableIndex === i; else readOnly">
                <input matInput [(ngModel)]="element.meeting" class="input-cell" />                
              </ng-container>
              <ng-template #readOnly>
                <div class="cell-content">{{element.meeting}}</div>
              </ng-template>
        </td>
      </ng-container>
  
      <ng-container matColumnDef="item">
        <th mat-header-cell *matHeaderCellDef
            class="table-header"
            [style.font-size]="tblFontsize"> 
            ToDo項目
        </th>
        <td mat-cell *matCellDef="let element; let i = index"
            class="table-cell"
            [style.font-size]="tblFontsize">
              <ng-container *ngIf="editableIndex === i; else readOnly">
                <input matInput [(ngModel)]="element.item" class="input-cell" />                
              </ng-container>
              <ng-template #readOnly>
                <div class="cell-content">{{element.item}}</div>
              </ng-template>
        </td>
      </ng-container>
      
      <ng-container matColumnDef="begintime">
        <th mat-header-cell *matHeaderCellDef 
            class="table-header qright"
            [style.font-size]="tblFontsize"> 
            開始時刻 
        </th>
        <td mat-cell *matCellDef="let element; let i = index"
            class="table-cell qright"
            [style.font-size]="tblFontsize">
              <ng-container *ngIf="editableIndex === i; else readOnly">
                <input matInput [(ngModel)]="element.begintime" class="input-cell" />                
              </ng-container>
              <ng-template #readOnly>
                <div class="cell-content">{{element.begintime}}</div>
              </ng-template>
        </td>
      </ng-container>
    
      <ng-container matColumnDef="endtime">
        <th mat-header-cell *matHeaderCellDef 
            class="table-header"
            [style.font-size]="tblFontsize"> 
            終了時刻
        </th>
        <td mat-cell *matCellDef="let element; let i = index"
            class="table-cell"
            [style.font-size]="tblFontsize">
              <ng-container *ngIf="editableIndex === i; else readOnly">
                <input matInput [(ngModel)]="element.endtime" class="input-cell" />                
              </ng-container>
              <ng-template #readOnly>
                <div class="cell-content">{{element.endtime}}</div>
              </ng-template>
        </td>
      </ng-container>
  
      <ng-container matColumnDef="plantime">
        <th mat-header-cell *matHeaderCellDef 
            class="table-header"
            [style.font-size]="tblFontsize"> 
            計画時間
        </th>
        <td mat-cell *matCellDef="let element; let i = index"
            class="table-cell"
            [style.font-size]="tblFontsize">
              <ng-container *ngIf="editableIndex === i; else readOnly">
                <input matInput [(ngModel)]="element.plantime" class="input-cell" />                
              </ng-container>
              <ng-template #readOnly>
                <div class="cell-content">{{element.plantime}}</div>
              </ng-template>
        </td>
      </ng-container>
  
      <ng-container matColumnDef="actualtime">
        <th mat-header-cell *matHeaderCellDef 
            class="table-header"
            [style.font-size]="tblFontsize"> 
            実績時間 
        </th>
        <td mat-cell *matCellDef="let element; let i = index"
            class="table-cell"
            [style.font-size]="tblFontsize">
              <ng-container *ngIf="editableIndex === i; else readOnly">
                <input matInput [(ngModel)]="element.actualtime" class="input-cell" />                
              </ng-container>
              <ng-template #readOnly>
                <div class="cell-content">{{element.actualtime}}</div>
              </ng-template>
        </td>
      </ng-container>
  
      <ng-container matColumnDef="diffefent">
        <th mat-header-cell *matHeaderCellDef 
            class="table-header"
            [style.font-size]="tblFontsize"> 
            差異 
        </th>
        <td mat-cell *matCellDef="let element; let i = index"
            class="table-cell"
            [style.font-size]="tblFontsize">
              <ng-container *ngIf="editableIndex === i; else readOnly">
                <input matInput [(ngModel)]="element.diffefent" class="input-cell" />                
              </ng-container>
              <ng-template #readOnly>
                <div class="cell-content">{{element.diffefent}}</div>
              </ng-template>
        </td>
      </ng-container>
  
      <ng-container matColumnDef="planbegintime">
        <th mat-header-cell *matHeaderCellDef 
            class="table-header"
            [style.font-size]="tblFontsize"> 
            計画時刻
        </th>
        <td mat-cell *matCellDef="let element; let i = index"
            class="table-cell"
            [style.font-size]="tblFontsize">
              <ng-container *ngIf="editableIndex === i; else readOnly">
                <input matInput [(ngModel)]="element.planbegintime" class="input-cell" />                
              </ng-container>
              <ng-template #readOnly>
                <div class="cell-content">{{element.planbegintime}}</div>
              </ng-template>
        </td>
      </ng-container>

      <ng-container matColumnDef="etc">
        <th mat-header-cell *matHeaderCellDef 
            class="table-header"
            [style.font-size]="tblFontsize"> 
            備考
        </th>
        <td mat-cell *matCellDef="let element; let i = index"
            class="table-cell"
            [style.font-size]="tblFontsize">
              <ng-container *ngIf="editableIndex === i; else readOnly">
                <input matInput [(ngModel)]="element.etc" class="input-cell" />                
              </ng-container>
              <ng-template #readOnly>
                <div class="cell-content">{{element.etc}}</div>
              </ng-template>
        </td>
      </ng-container>

      <!-- 削除ボタン列を追加 -->
      <ng-container matColumnDef="delete">
        <th mat-header-cell *matHeaderCellDef> 削除 </th>
        <td mat-cell *matCellDef="let element; let i = index">
          <button mat-icon-button color="warn" (click)="deleteRow(i)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="my-row"></tr>
    </table>
</div>
    